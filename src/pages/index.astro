  <script>
    const $ = id => document.getElementById(id);
    const c = $('c'), ctx = c.getContext('2d');
    const fullOverlay = $('fullscreen-overlay'), fullCanvas = $('fullCanvas'), fctx = fullCanvas.getContext('2d');

    const S = {
      accent: $('accent').value,
      busy: $('statusColorBusy').value,
      avail: $('statusColorAvail').value,
      text: {
        room:'R105 Projekti S',
        sub:'R103',
        status:'BUSY',
        time:'15:00 - 18:00',
        note:'Your paragraph text',
        date:'dd/mm/yyyy',
        cap:'8 persons',
        aud:'Staff, Student'
      },
      pos:{
        room:{x:32,y:24},
        sub:{x:32,y:128},
        note:{x:800,y:260,align:'center'},
        status:{x:32,y:270},
        time:{x:32,y:460},
        cap:{x:32,y:820},
        aud:{x:800,y:820,align:'center'},
        date:{x:1568,y:820,align:'right'}
      },
      size:{ room:120, sub:56, status:160, time:64, note:28, footer:36 },
      bold:{ room:true, sub:true, status:true, time:true, note:false, footer:false },
      fontGlobal:"system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial, sans-serif",
      fontCustom:"",
      fontOverride:{ room:"", sub:"", status:"", time:"", note:"", footer:"" }
    };

    function fontFamilyFor(key){
      const over = S.fontOverride[key] || "";
      const base = S.fontCustom.trim() ? S.fontCustom.trim() : S.fontGlobal;
      return over || base;
    }
    function weightFor(k){
      if (k==='cap'||k==='aud'||k==='date') return S.bold.footer ? '900' : '400';
      return S.bold[k] ? '900' : '400';
    }
    function fontOf(k){
      const size = (k==='cap'||k==='aud'||k==='date') ? S.size.footer : S.size[k];
      return `${weightFor(k)} ${size}px ${fontFamilyFor(k)}`;
    }

    function items(){
      const col = S.text.status==='AVAILABLE' ? S.avail : S.busy;
      return [
        {k:'room',   t:S.text.room,   c:'#000', a:'left'},
        {k:'sub',    t:S.text.sub,    c:'#000', a:'left'},
        {k:'note',   t:S.text.note,   c:'#000', a:S.pos.note.align||'center'},
        {k:'status', t:S.text.status, c:col,    a:'left'},
        {k:'time',   t:S.text.time,   c:'#000', a:'left'},
        {k:'cap',    t:'Capacity: '+S.text.cap, c:'#000', a:'left'},
        {k:'aud',    t:'Available to: '+S.text.aud, c:'#000', a:S.pos.aud.align||'center'},
        {k:'date',   t:S.text.date,   c:'#000', a:S.pos.date.align||'right'}
      ];
    }

    function draw(context=ctx){
      const w=1600,h=900;
      const bannerH = 300; // roughly top 1/3

      context.clearRect(0,0,w,h);
      context.fillStyle='#fff';
      context.fillRect(0,0,w,h);

      // red accent bar on top third
      context.fillStyle = S.accent;
      context.fillRect(0,0,w,bannerH);

      for(const it of items()){
        context.textBaseline='top';
        context.textAlign=it.a;
        context.fillStyle=it.c;
        context.font = fontOf(it.k);
        context.fillText(it.t, S.pos[it.k].x, S.pos[it.k].y);
      }
    }

    // Dragging
    const pt=e=>{
      const r=c.getBoundingClientRect();
      return {x:(e.clientX-r.left)*c.width/r.width,y:(e.clientY-r.top)*c.height/r.height};
    };
    function boxOf(k,t,a){
      ctx.font = fontOf(k);
      const m = ctx.measureText(t);
      const sz = (k==='cap'||k==='aud'||k==='date') ? S.size.footer : S.size[k];
      const h = sz*1.2;
      let x = S.pos[k].x;
      if(a==='center') x -= m.width/2;
      if(a==='right')  x -= m.width;
      return {x,y:S.pos[k].y,w:m.width,h};
    }
    const pick=(x,y)=>{
      const order=['date','aud','cap','time','status','note','sub','room'];
      for(const k of order){
        const it = items().find(i=>i.k===k);
        const b = boxOf(k,it.t,it.a);
        if(x>=b.x&&x<=b.x+b.w&&y>=b.y&&y<=b.y+b.h) return k;
      }
      return null;
    };
    let dragging=null, off={dx:0,dy:0};
    c.addEventListener('pointerdown',e=>{
      c.setPointerCapture(e.pointerId);
      const p=pt(e), k=pick(p.x,p.y);
      if(!k) return;
      dragging=k;
      const it = items().find(i=>i.k===k);
      const b = boxOf(k,it.t,it.a);
      off.dx=p.x-b.x; off.dy=p.y-b.y;
      c.style.cursor='grabbing';
    });
    c.addEventListener('pointermove',e=>{
      if(!dragging) return;
      const p=pt(e);
      const it = items().find(i=>i.k===dragging);
      const b = boxOf(dragging,it.t,it.a);
      let nx=p.x-off.dx, ny=p.y-off.dy;
      const align = S.pos[dragging].align || it.a;
      if(align==='center') nx+=b.w/2;
      if(align==='right')  nx+=b.w;
      S.pos[dragging].x=nx; S.pos[dragging].y=ny;
      draw();
    });
    c.addEventListener('pointerup',()=>{ dragging=null; c.style.cursor='grab'; });

    // Text inputs
    const bindText = (id,key) => $(id).addEventListener('input', ()=>{
      S.text[key]=$(id).value;
      draw();
    });
    bindText('room','room');
    bindText('subroom','sub');
    bindText('time','time');
    bindText('note','note');
    bindText('date','date');
    bindText('cap','cap');
    bindText('aud','aud');
    $('status').addEventListener('change', ()=>{
      S.text.status=$('status').value.toUpperCase();
      draw();
    });

    // Colors
    $('accent').addEventListener('input', ()=>{
      S.accent=$('accent').value;
      draw();
    });
    $('statusColorBusy').addEventListener('input', ()=>{
      S.busy=$('statusColorBusy').value;
      draw();
    });
    $('statusColorAvail').addEventListener('input', ()=>{
      S.avail=$('statusColorAvail').value;
      draw();
    });

    // Fonts
    $('fontGlobal').addEventListener('change', ()=>{
      S.fontGlobal = $('fontGlobal').value;
      draw();
    });
    $('fontCustom').addEventListener('input', ()=>{
      S.fontCustom = $('fontCustom').value;
      draw();
    });
    ['room','sub','status','time','note','footer'].forEach(k=>{
      const sel = $('font-'+k);
      sel.addEventListener('change', ()=>{
        S.fontOverride[k] = sel.value;
        draw();
      });
    });

    // Sizes
    const sizeBind=(id,key)=>$(id).addEventListener('input', ()=>{
      S.size[key]=+$(id).value;
      draw();
    });
    sizeBind('size-room','room');
    sizeBind('size-sub','sub');
    sizeBind('size-status','status');
    sizeBind('size-time','time');
    sizeBind('size-note','note');
    sizeBind('size-footer','footer');

    // Bolds
    const boldBind=(id,key)=>$(id).addEventListener('change', ()=>{
      S.bold[key]=$(id).checked;
      draw();
    });
    boldBind('bold-room','room');
    boldBind('bold-sub','sub');
    boldBind('bold-status','status');
    boldBind('bold-time','time');
    boldBind('bold-note','note');
    boldBind('bold-footer','footer');

    // Download / Copy / Fullscreen
    $('download').addEventListener('click',()=>{
      const a=document.createElement('a');
      a.download='room-sign.png';
      a.href=c.toDataURL('image/png');
      a.click();
    });
    $('copy').addEventListener('click', async()=>{
      const blob=await new Promise(r=>c.toBlob(r,'image/png'));
      try{
        await navigator.clipboard.write([new ClipboardItem({'image/png':blob})]);
        alert('Copied');
      }catch{
        alert('Copy failed');
      }
    });
    function openFs(){
      draw(fctx);
      fullOverlay.style.display='flex';
      fullOverlay.requestFullscreen?.();
    }
    $('fullscreen').addEventListener('click', openFs);
    c.addEventListener('click', openFs);
    fullOverlay.addEventListener('click', ()=>{
      document.exitFullscreen?.();
      fullOverlay.style.display='none';
    });

    // Initialize defaults
    $('fontGlobal').value = S.fontGlobal;
    $('room').value=S.text.room;
    $('subroom').value=S.text.sub;
    $('status').value=S.text.status;
    $('time').value=S.text.time;
    $('note').value=S.text.note;
    $('date').value=S.text.date;
    $('cap').value=S.text.cap;
    $('aud').value=S.text.aud;

    draw();
  </script>
